<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>背景音</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --text-primary: #fff;
            --text-secondary: rgba(255, 255, 255, 0.6);
            --glass: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.12);
            --accent-blue: #3b82f6;
            --accent-green: rgb(48, 209, 88);
            --accent-red: #ef4444;
            --ios-bg: rgba(30, 30, 30, 0.88);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Cormorant Garamond', Georgia, serif;
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: var(--text-primary);
            overflow: hidden;
            background: #1a1a1a;
        }

        /* 加载遮罩 - 优化尺寸 */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(20, 20, 20, 0.95);
            -webkit-backdrop-filter: blur(30px);
            backdrop-filter: blur(30px);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .loader {
            position: relative;
            width: 36px;
            height: 36px;
            border-radius: 10px;
        }

        .loader div {
            width: 8%;
            height: 24%;
            background: rgb(128, 128, 128);
            position: absolute;
            left: 50%;
            top: 30%;
            opacity: 0;
            border-radius: 50px;
            box-shadow: 0 0 3px rgba(0,0,0,0.2);
            animation: fade458 1s linear infinite;
        }

        @keyframes fade458 {
            from { opacity: 1; }
            to { opacity: 0.25; }
        }

        .loader .bar1 { transform: rotate(0deg) translate(0, -130%); animation-delay: 0s; }
        .loader .bar2 { transform: rotate(30deg) translate(0, -130%); animation-delay: -1.1s; }
        .loader .bar3 { transform: rotate(60deg) translate(0, -130%); animation-delay: -1s; }
        .loader .bar4 { transform: rotate(90deg) translate(0, -130%); animation-delay: -0.9s; }
        .loader .bar5 { transform: rotate(120deg) translate(0, -130%); animation-delay: -0.8s; }
        .loader .bar6 { transform: rotate(150deg) translate(0, -130%); animation-delay: -0.7s; }
        .loader .bar7 { transform: rotate(180deg) translate(0, -130%); animation-delay: -0.6s; }
        .loader .bar8 { transform: rotate(210deg) translate(0, -130%); animation-delay: -0.5s; }
        .loader .bar9 { transform: rotate(240deg) translate(0, -130%); animation-delay: -0.4s; }
        .loader .bar10 { transform: rotate(270deg) translate(0, -130%); animation-delay: -0.3s; }
        .loader .bar11 { transform: rotate(300deg) translate(0, -130%); animation-delay: -0.2s; }
        .loader .bar12 { transform: rotate(330deg) translate(0, -130%); animation-delay: -0.1s; }

        .bg-layer {
            position: fixed;
            inset: 0;
            background-size: cover;
            background-position: center;
            transition: opacity 1.2s ease;
            opacity: 0;
            z-index: 1;
        }

        .bg-layer.active {
            opacity: 1;
        }

        .overlay {
            position: fixed;
            inset: 0;
            background: linear-gradient(
                to bottom,
                rgba(0, 0, 0, 0.3) 0%,
                rgba(0, 0, 0, 0.5) 100%
            );
            z-index: 2;
        }

        .container {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            width: 100%;
            max-width: 500px;
        }

        .now-playing {
            text-align: center;
            margin-bottom: 50px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeUp 0.8s ease 0.2s forwards;
        }

        .now-playing .label {
            font-size: 0.75rem;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .song-selector-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 2.8rem;
            font-weight: 300;
            letter-spacing: 2px;
            cursor: pointer;
            transition: opacity 0.3s ease;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        .song-selector-btn:hover {
            opacity: 0.8;
        }

        @keyframes fadeUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 播放按钮 - 使用真实模糊背景 */
        .play-btn-wrapper {
            position: relative;
            width: 100px;
            height: 100px;
            margin-bottom: 60px;
            opacity: 0;
            transform: scale(0.8);
            animation: scaleIn 0.6s ease 0.4s forwards;
        }

        /* 移除复杂的模糊背景层 */
        .play-btn-blur {
            display: none; /* 不再需要这个元素 */
        }

        .play-btn {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            /* 直接应用模糊和半透明背景 */
            background: rgba(0, 0, 0, 0.2);
            -webkit-backdrop-filter: blur(15px);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.4s cubic-bezier(0.4, 0, 0.2, 1), color 0.4s ease, backdrop-filter 0.4s ease;
            position: relative;
            z-index: 3;
            color: #fff;
        }

        .play-btn.playing {
            background: rgba(255, 255, 255, 0.95);
            color: var(--accent-blue);
            -webkit-backdrop-filter: blur(0px); /* 播放时移除模糊效果 */
            backdrop-filter: blur(0px);
        }

        .play-btn svg {
            width: 48px;
            height: 48px;
        }

        /* 水波纹容器 */
        .ripple-container {
            position: absolute;
            inset: 0;
            z-index: 0;
            pointer-events: none;
        }

        .ripple {
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.35);
            animation: rippleExpand 3s ease-out forwards;
        }

        @keyframes rippleExpand {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.6); opacity: 0; }
        }

        @keyframes scaleIn {
            to { opacity: 1; transform: scale(1); }
        }

        /* 底部控制栏 */
        .bottom-controls {
            position: fixed;
            bottom: 36px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .control-btn {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            border: none;
            color: var(--text-secondary);
        }

        .control-btn:hover {
            color: var(--text-primary);
        }

        .control-btn svg {
            width: 24px;
            height: 24px;
        }

        /* 倒计时显示 */
        .countdown-container {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.4s ease;
            cursor: pointer;
        }

        .countdown-container.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .countdown-time {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-primary);
            letter-spacing: 0.5px;
        }

        .countdown-label {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .countdown-container.ending .countdown-time {
            color: #f87171;
        }

        .countdown-container.ending .countdown-label {
            color: rgba(248, 113, 113, 0.7);
        }

        /* iOS 风格 Action Sheet */
        .ios-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .ios-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .ios-menu {
            position: fixed;
            bottom: 20px;
            left: 10px;
            right: 10px;
            max-width: 400px;
            margin: 0 auto;
            z-index: 1001;
            transform: translateY(150%);
            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .ios-menu.show {
            transform: translateY(0);
        }

        .ios-menu-group {
            background: var(--ios-bg);
            -webkit-backdrop-filter: blur(40px);
            backdrop-filter: blur(40px);
            border-radius: 14px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .ios-menu-item {
            width: 100%;
            padding: 16px;
            background: transparent;
            border: none;
            border-bottom: 0.5px solid rgba(255, 255, 255, 0.1);
            color: var(--accent-blue);
            font-size: 1.1rem;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
            cursor: pointer;
            transition: background 0.15s ease;
            text-align: center;
        }

        .ios-menu-item:last-child {
            border-bottom: none;
        }

        .ios-menu-item.tapped {
            background: rgba(255, 255, 255, 0.12);
        }

        .ios-menu-item.danger {
            color: var(--accent-red);
        }

        /* iOS 音量滑块菜单 */
        .ios-volume-header {
            padding: 12px 16px 8px;
            text-align: center;
            border-bottom: 0.5px solid rgba(255, 255, 255, 0.1);
        }

        .ios-volume-title {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            font-size: 0.8rem;
            color: var(--text-secondary);
            letter-spacing: 0.3px;
        }

        .ios-volume-container {
            padding: 14px 20px 18px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .ios-volume-icon {
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        .ios-volume-icon svg {
            width: 18px;
            height: 18px;
            display: block;
        }

        .ios-volume-slider {
            flex: 1;
            height: 28px;
            display: flex;
            align-items: center;
            position: relative;
            cursor: pointer;
            touch-action: none;
        }

        .ios-volume-track {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 2px;
            position: relative;
            overflow: hidden;
        }

        .ios-volume-fill {
            height: 100%;
            background: var(--accent-green);
            border-radius: 2px;
        }

        .ios-volume-thumb {
            width: 22px;
            height: 22px;
            background: #fff;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
            z-index: 10;
        }

        .ios-volume-thumb:active {
            transform: translate(-50%, -50%) scale(1.1);
        }

        .ios-cancel {
            background: var(--ios-bg);
            -webkit-backdrop-filter: blur(40px);
            backdrop-filter: blur(40px);
            border-radius: 14px;
            width: 100%;
            padding: 16px;
            border: none;
            color: var(--accent-blue);
            font-size: 1.1rem;
            font-weight: 600;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
            cursor: pointer;
            text-align: center;
            transition: background 0.15s ease;
        }

        .ios-cancel.tapped {
            background: rgba(255, 255, 255, 0.08);
        }

        /* 自定义定时器编辑弹窗 */
        .timer-edit-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .timer-edit-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .timer-edit-container {
            background: var(--ios-bg);
            -webkit-backdrop-filter: blur(40px);
            backdrop-filter: blur(40px);
            border-radius: 14px;
            width: 100%;
            max-width: 360px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .timer-edit-modal.show .timer-edit-container {
            transform: scale(1);
        }

        .timer-edit-header {
            padding: 20px 16px 16px;
            border-bottom: 0.5px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .timer-edit-title {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .timer-edit-done {
            background: none;
            border: none;
            color: var(--accent-blue);
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            padding: 4px 8px;
        }

        .timer-edit-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }

        .timer-edit-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: transparent;
            border-bottom: 0.5px solid rgba(255, 255, 255, 0.08);
            cursor: move;
            transition: background 0.15s ease;
        }

        .timer-edit-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .timer-edit-item.dragging {
            opacity: 0.5;
        }

        .timer-drag-handle {
            color: var(--text-secondary);
            margin-right: 12px;
            cursor: grab;
        }

        .timer-drag-handle:active {
            cursor: grabbing;
        }

        .timer-drag-handle svg {
            width: 20px;
            height: 20px;
        }

        .timer-edit-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .timer-edit-label {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            font-size: 1rem;
            color: var(--text-primary);
        }

        .timer-edit-time {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .timer-delete-btn {
            background: none;
            border: none;
            color: var(--accent-red);
            cursor: pointer;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 8px;
        }

        .timer-delete-btn svg {
            width: 20px;
            height: 20px;
        }

        .timer-add-btn {
            margin: 8px 16px;
            padding: 12px;
            background: rgba(59, 130, 246, 0.15);
            border: none;
            border-radius: 8px;
            color: var(--accent-blue);
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: background 0.15s ease;
        }

        .timer-add-btn:hover {
            background: rgba(59, 130, 246, 0.25);
        }

        .timer-add-btn svg {
            width: 18px;
            height: 18px;
        }

        /* 添加/编辑定时器表单 */
        .timer-form-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 2100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .timer-form-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .timer-form-container {
            background: var(--ios-bg);
            -webkit-backdrop-filter: blur(40px);
            backdrop-filter: blur(40px);
            border-radius: 14px;
            width: 100%;
            max-width: 320px;
            padding: 20px;
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .timer-form-modal.show .timer-form-container {
            transform: scale(1);
        }

        .timer-form-title {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
            text-align: center;
        }

        .timer-form-group {
            margin-bottom: 16px;
        }

        .timer-form-label {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: block;
        }

        .timer-form-input {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            font-size: 1rem;
            outline: none;
            transition: all 0.2s ease;
        }

        .timer-form-input:focus {
            background: rgba(255, 255, 255, 0.12);
            border-color: var(--accent-blue);
        }

        .timer-form-input::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        .timer-form-buttons {
            display: flex;
            gap: 12px; /* 保持12px的gap */
            margin-top: 20px;
        }

        .timer-form-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s ease;
            /* 修正布局：添加margin以确保与边缘的距离 */
            margin: 0 4px;
        }
        .timer-form-buttons {
            /* 修正布局：增加gap并移除子元素的margin来简化 */
            gap: 16px;
            margin-top: 24px;
        }
        .timer-form-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s ease;
            margin: 0; /* 移除margin */
        }


        .timer-form-btn.cancel {
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-primary);
        }

        .timer-form-btn.cancel:hover {
            background: rgba(255, 255, 255, 0.12);
        }

        .timer-form-btn.save {
            background: var(--accent-blue);
            color: white;
        }

        .timer-form-btn.save:hover {
            background: #2563eb;
        }

        @media (max-width: 480px) {
            .song-selector-btn { font-size: 2.2rem; }
        }
    </style>
</head>
<body>
    <!-- 加载遮罩 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loader">
            <div class="bar1"></div>
            <div class="bar2"></div>
            <div class="bar3"></div>
            <div class="bar4"></div>
            <div class="bar5"></div>
            <div class="bar6"></div>
            <div class="bar7"></div>
            <div class="bar8"></div>
            <div class="bar9"></div>
            <div class="bar10"></div>
            <div class="bar11"></div>
            <div class="bar12"></div>
        </div>
    </div>

    <div id="bgContainer"></div>
    <div class="overlay"></div>

    <div class="container">
        <div class="now-playing">
            <div class="label">Now Playing</div>
            <button class="song-selector-btn" id="songSelectorBtn">Ocean</button>
        </div>

        <div class="play-btn-wrapper">
            <div class="ripple-container" id="rippleContainer"></div>
            <button class="play-btn" id="playBtn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M6 10a7 7 0 1 1 13 3.6a10 10 0 0 1-2 2a8 8 0 0 0-2 3A4.5 4.5 0 0 1 8.2 20"/><path d="M10 10a3 3 0 1 1 5 2.2"/></g></svg>
            </button>
            <div class="play-btn-blur" id="playBtnBlur"></div>
        </div>
    </div>

    <!-- 底部控制栏 -->
    <div class="bottom-controls">
        <!-- 定时器 -->
        <button class="control-btn" id="timerBtn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M10 3q-.425 0-.712-.288T9 2t.288-.712T10 1h4q.425 0 .713.288T15 2t-.288.713T14 3zm2 11q.425 0 .713-.288T13 13V9q0-.425-.288-.712T12 8t-.712.288T11 9v4q0 .425.288.713T12 14m0 8q-1.85 0-3.488-.712T5.65 19.35t-1.937-2.863T3 13t.713-3.488T5.65 6.65t2.863-1.937T12 4q1.55 0 2.975.5t2.675 1.45l.7-.7q.275-.275.7-.275t.7.275t.275.7t-.275.7l-.7.7Q20 8.6 20.5 10.025T21 13q0 1.85-.713 3.488T18.35 19.35t-2.863 1.938T12 22m0-2q2.9 0 4.95-2.05T19 13t-2.05-4.95T12 6T7.05 8.05T5 13t2.05 4.95T12 20m0-7"/></svg>
        </button>

        <!-- 倒计时显示 -->
        <div class="countdown-container" id="countdownContainer">
            <span class="countdown-time" id="countdownTime">5 min</span>
            <span class="countdown-label">后停止播放</span>
        </div>

        <!-- 音量调节 -->
        <button class="control-btn" id="volumeBtn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M19 11.975q0-2.075-1.1-3.787t-2.95-2.563q-.375-.175-.55-.537t-.05-.738q.15-.4.538-.575t.787 0Q18.1 4.85 19.55 7.063T21 11.974t-1.45 4.913t-3.875 3.287q-.4.175-.788 0t-.537-.575q-.125-.375.05-.737t.55-.538q1.85-.85 2.95-2.562t1.1-3.788M7 15H4q-.425 0-.712-.288T3 14v-4q0-.425.288-.712T4 9h3l3.3-3.3q.475-.475 1.088-.213t.612.938v11.15q0 .675-.612.938T10.3 18.3zm9.5-3q0 1.05-.475 1.988t-1.25 1.537q-.25.15-.513.013T14 15.1V8.85q0-.3.263-.437t.512.012q.775.625 1.25 1.575t.475 2"/></svg>
        </button>
    </div>

    <!-- iOS 风格菜单 -->
    <div class="ios-overlay" id="iosOverlay"></div>
    <div class="ios-menu" id="iosMenu">
        <div class="ios-menu-group" id="iosMenuGroup"></div>
        <button class="ios-cancel" id="iosCancel">取消</button>
    </div>

    <!-- 自定义定时器编辑弹窗 -->
    <div class="timer-edit-modal" id="timerEditModal">
        <div class="timer-edit-container">
            <div class="timer-edit-header">
                <div class="timer-edit-title">自定义定时器</div>
                <button class="timer-edit-done" id="timerEditDone">完成</button>
            </div>
            <div class="timer-edit-list" id="timerEditList"></div>
            <button class="timer-add-btn" id="timerAddBtn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M11 13H5v-2h6V5h2v6h6v2h-6v6h-2z"/></svg>
                添加定时器
            </button>
        </div>
    </div>

    <!-- 添加/编辑定时器表单 -->
    <div class="timer-form-modal" id="timerFormModal">
        <div class="timer-form-container">
            <div class="timer-form-title" id="timerFormTitle">添加定时器</div>
            <div class="timer-form-group">
                <label class="timer-form-label">显示名称（可选）</label>
                <input type="text" class="timer-form-input" id="timerLabelInput" placeholder="例如：午休">
            </div>
            <div class="timer-form-group">
                <label class="timer-form-label">时长（分钟）</label>
                <input type="number" class="timer-form-input" id="timerValueInput" placeholder="例如：10" min="1" max="999">
            </div>
            <div class="timer-form-buttons">
                <button class="timer-form-btn cancel" id="timerFormCancel">取消</button>
                <button class="timer-form-btn save" id="timerFormSave">保存</button>
            </div>
        </div>
    </div>

    <script>
        const musicData = [
            { name: 'Ocean', file: 'Ocean.m4a', img: 'Ocean.jpg' },
            { name: 'Brown Noise', file: 'BrownNoise.m4a', img: 'BrownNoise.jpg' },
            { name: 'Pink Noise', file: 'PinkNoise.m4a', img: 'PinkNoise.jpg' },
            { name: 'Rain', file: 'Rain.m4a', img: 'Rain.jpg' },
            { name: 'Stream', file: 'Stream.m4a', img: 'Stream.jpg' },
            { name: 'White Noise', file: 'WhiteNoise.m4a', img: 'WhiteNoise.jpg' }
        ];

        // 默认定时器选项
        const defaultTimerOptions = [
            { label: '15 分钟', value: 15 },
            { label: '30 分钟', value: 30 },
            { label: '1 小时', value: 60 }
        ];

        // 为定时器选项生成唯一ID
        function generateTimerId(timer) {
            return `${timer.value}-${timer.label || ''}`;
        }

        // 加载自定义定时器
        function loadCustomTimers() {
            return loadFromStorage('custom_timers', []);
        }

        // 保存自定义定时器
        function saveCustomTimers(timers) {
            saveToStorage('custom_timers', timers);
        }

        // 获取所有定时器选项（自定义 + 默认）
        function getAllTimerOptions() {
            const customTimers = loadCustomTimers();
            // 为每个选项添加唯一ID
            const allTimers = [...customTimers, ...defaultTimerOptions].map(timer => ({
                ...timer,
                id: generateTimerId(timer)
            }));
            return allTimers;
        }

        const bgContainer = document.getElementById('bgContainer');
        const playBtn = document.getElementById('playBtn');
        const rippleContainer = document.getElementById('rippleContainer');
        const songSelectorBtn = document.getElementById('songSelectorBtn');
        const volumeBtn = document.getElementById('volumeBtn');
        const timerBtn = document.getElementById('timerBtn');
        const countdownContainer = document.getElementById('countdownContainer');
        const countdownTime = document.getElementById('countdownTime');
        const iosOverlay = document.getElementById('iosOverlay');
        const iosMenu = document.getElementById('iosMenu');
        const iosMenuGroup = document.getElementById('iosMenuGroup');
        const iosCancel = document.getElementById('iosCancel');
        const loadingOverlay = document.getElementById('loadingOverlay');

        // 自定义定时器相关元素
        const timerEditModal = document.getElementById('timerEditModal');
        const timerEditDone = document.getElementById('timerEditDone');
        const timerEditList = document.getElementById('timerEditList');
        const timerAddBtn = document.getElementById('timerAddBtn');
        const timerFormModal = document.getElementById('timerFormModal');
        const timerFormTitle = document.getElementById('timerFormTitle');
        const timerLabelInput = document.getElementById('timerLabelInput');
        const timerValueInput = document.getElementById('timerValueInput');
        const timerFormCancel = document.getElementById('timerFormCancel');
        const timerFormSave = document.getElementById('timerFormSave');

        let audioContext = null;
        let gainNode = null;
        let currentSource = null;
        const audioBufferCache = {};

        // 使用 localStorage 替代 Cookie
        function saveToStorage(key, value) {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch (e) {
                console.error('存储失败:', e);
            }
        }

        function loadFromStorage(key, defaultValue) {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch (e) {
                return defaultValue;
            }
        }

        let currentIndex = loadFromStorage('bg_currentIndex', 0);
        let baseVolume = loadFromStorage('bg_baseVolume', 0.8);
        let isPlaying = false;
        let isLoading = false;
        let switchId = 0;

        let timerInterval = null;
        let remainingSeconds = 0;
        let currentTimerId = null; // 存储当前定时器的唯一ID
        const FADE_DURATION = 10;
        const CROSSFADE_TIME = 1.0;

        // 水波纹控制 - 优化性能
        let rippleInterval = null;
        let lastRippleTime = 0;
        const RIPPLE_THROTTLE = 950; // 略小于1000ms以确保流畅

        // 初始化背景
        musicData.forEach((item, index) => {
            const layer = document.createElement('div');
            layer.className = 'bg-layer' + (index === currentIndex ? ' active' : '');
            layer.style.backgroundImage = `url('img/${item.img}')`;
            bgContainer.appendChild(layer);
        });
        songSelectorBtn.textContent = musicData[currentIndex].name;

        // 资源预加载 - 优化性能
        async function preloadAllResources() {
            const imagePromises = musicData.map(item => {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = img.onerror = resolve;
                    img.src = `img/${item.img}`;
                });
            });

            initAudioContext();
            
            // 优先加载当前音乐
            await loadAudioBuffer(`music/${musicData[currentIndex].file}`).catch(() => null);

            // 后台加载其他音乐
            const audioPromises = musicData
                .filter((_, i) => i !== currentIndex)
                .map(item => loadAudioBuffer(`music/${item.file}`).catch(() => null));

            await Promise.all(imagePromises);
            Promise.all(audioPromises); // 不阻塞UI
            
            loadingOverlay.classList.add('hidden');
        }

        function initAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                gainNode = audioContext.createGain();
                gainNode.gain.value = 0;
                gainNode.connect(audioContext.destination);
            }
            if (audioContext.state === 'suspended') audioContext.resume();
        }

        async function loadAudioBuffer(url) {
            if (audioBufferCache[url]) return audioBufferCache[url];
            try {
                const response = await fetch(url);
                const arrayBuffer = await response.arrayBuffer();
                const buffer = await audioContext.decodeAudioData(arrayBuffer);
                audioBufferCache[url] = buffer;
                return buffer;
            } catch (error) {
                console.error(`加载音频失败: ${url}`, error);
                throw error;
            }
        }

        // 水波纹管理 - 性能优化
        function createRipple() {
            const now = Date.now();
            if (now - lastRippleTime < RIPPLE_THROTTLE) return;
            lastRippleTime = now;

            const ripple = document.createElement('div');
            ripple.className = 'ripple';
            rippleContainer.appendChild(ripple);

            ripple.addEventListener('animationend', () => ripple.remove(), { once: true });
        }

        function startRipples() {
            if (rippleInterval) return;
            createRipple();
            rippleInterval = setInterval(createRipple, 1000);
        }

        function stopRipples() {
            clearInterval(rippleInterval);
            rippleInterval = null;
            rippleContainer.innerHTML = '';
        }

        // 切换音乐 - 优化性能
        async function switchMusic(index) {
            if (currentIndex === index || isLoading) return;

            const thisSwitchId = ++switchId;
            initAudioContext();
            isLoading = true;
            songSelectorBtn.style.opacity = '0.5';

            const bgLayers = bgContainer.querySelectorAll('.bg-layer');
            bgLayers[currentIndex].classList.remove('active');
            bgLayers[index].classList.add('active');

            currentIndex = index;
            saveToStorage('bg_currentIndex', currentIndex);
            songSelectorBtn.textContent = musicData[index].name;
            
            if (isPlaying && currentSource) {
                const now = audioContext.currentTime;
                gainNode.gain.cancelScheduledValues(now);
                gainNode.gain.setValueAtTime(gainNode.gain.value, now);
                gainNode.gain.linearRampToValueAtTime(0, now + CROSSFADE_TIME);

                const oldSource = currentSource;
                currentSource = null;
                setTimeout(() => { try { oldSource.stop(); oldSource.disconnect(); } catch(e) {} }, CROSSFADE_TIME * 1000);

                try {
                    const buffer = await loadAudioBuffer(`music/${musicData[index].file}`);
                    if (thisSwitchId !== switchId) return; // 切换中断

                    await new Promise(r => setTimeout(r, CROSSFADE_TIME * 1000));
                    if (thisSwitchId !== switchId || !isPlaying) return; // 切换中断或已暂停

                    const newSource = audioContext.createBufferSource();
                    newSource.buffer = buffer;
                    newSource.loop = true;
                    newSource.connect(gainNode);
                    newSource.start(0);
                    currentSource = newSource;

                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(baseVolume, audioContext.currentTime + CROSSFADE_TIME);
                } catch(e) {
                    console.error('切换音乐失败:', e);
                } finally {
                    if (thisSwitchId === switchId) {
                        isLoading = false;
                        songSelectorBtn.style.opacity = '1';
                    }
                }
            } else {
                isLoading = false;
                songSelectorBtn.style.opacity = '1';
            }
        }

        async function togglePlay() {
            initAudioContext();
            const now = audioContext.currentTime;

            if (isPlaying) {
                gainNode.gain.cancelScheduledValues(now);
                gainNode.gain.setValueAtTime(gainNode.gain.value, now);
                gainNode.gain.linearRampToValueAtTime(0, now + CROSSFADE_TIME);

                stopRipples();
                isPlaying = false;
                playBtn.classList.remove('playing');

                const oldSource = currentSource;
                currentSource = null;
                setTimeout(() => { if (oldSource) { try { oldSource.stop(); oldSource.disconnect(); } catch(e) {} } }, CROSSFADE_TIME * 1000);
            } else {
                if (isLoading) return;
                isLoading = true;
                songSelectorBtn.style.opacity = '0.5';
                try {
                    const buffer = await loadAudioBuffer(`music/${musicData[currentIndex].file}`);
                    const source = audioContext.createBufferSource();
                    source.buffer = buffer;
                    source.loop = true;
                    source.connect(gainNode);
                    source.start(0);
                    currentSource = source;

                    gainNode.gain.cancelScheduledValues(now);
                    gainNode.gain.setValueAtTime(0, now);
                    gainNode.gain.linearRampToValueAtTime(baseVolume, now + CROSSFADE_TIME);

                    playBtn.classList.add('playing');
                    isPlaying = true;
                    startRipples();
                } catch(e) {
                    console.error("播放失败:", e);
                } finally { 
                    isLoading = false; 
                    songSelectorBtn.style.opacity = '1'; 
                }
            }
        }

        playBtn.onclick = togglePlay;

        // 菜单项点击效果
        function addTapEffect(element) {
            const addTap = () => element.classList.add('tapped');
            const removeTap = () => element.classList.remove('tapped');
            ['touchstart', 'mousedown'].forEach(evt => element.addEventListener(evt, addTap, { passive: true }));
            ['touchend', 'touchcancel', 'mouseup', 'mouseleave'].forEach(evt => element.addEventListener(evt, removeTap, { passive: true }));
        }

        // iOS 菜单
        function showIOSMenu(items, onSelect, menuType = 'default') {
            iosMenuGroup.innerHTML = '';
            
            // 修复 #4：根据菜单类型修改取消按钮文本
            iosCancel.textContent = menuType === 'volume' ? '完成' : '取消';

            if (menuType === 'volume') {
                iosMenuGroup.innerHTML = `
                    <div class="ios-volume-header"><span class="ios-volume-title">音量调节</span></div>
                    <div class="ios-volume-container">
                        <div class="ios-volume-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M7 15H4q-.425 0-.712-.288T3 14v-4q0-.425.288-.712T4 9h3l3.3-3.3q.475-.475 1.088-.213t.612.938v11.15q0 .675-.612.938T10.3 18.3z"/></svg></div>
                        <div class="ios-volume-slider" id="iosVolumeSlider">
                            <div class="ios-volume-track"><div class="ios-volume-fill" id="iosVolumeFill"></div></div>
                            <div class="ios-volume-thumb" id="iosVolumeThumb"></div>
                        </div>
                        <div class="ios-volume-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M19 11.975q0-2.075-1.1-3.787t-2.95-2.563q-.375-.175-.55-.537t-.05-.738q.15-.4.538-.575t.787 0Q18.1 4.85 19.55 7.063T21 11.974t-1.45 4.913t-3.875 3.287q-.4.175-.788 0t-.537-.575q-.125-.375.05-.737t.55-.538q1.85-.85 2.95-2.562t1.1-3.788M7 15H4q-.425 0-.712-.288T3 14v-4q0-.425.288-.712T4 9h3l3.3-3.3q.475-.475 1.088-.213t.612.938v11.15q0 .675-.612.938T10.3 18.3zm9.5-3q0 1.05-.475 1.988t-1.25 1.537q-.25.15-.513.013T14 15.1V8.85q0-.3.263-.437t.512.012q.775.625 1.25 1.575t.475 2"/></svg></div>
                    </div>`;
                
                // 延迟执行以确保元素已渲染
                setTimeout(() => setupVolumeSlider(), 0);

            } else if (menuType === 'countdown') {
                const btn = document.createElement('button');
                btn.className = 'ios-menu-item danger';
                btn.textContent = '停止定时';
                addTapEffect(btn);
                btn.onclick = () => { clearTimer(); hideIOSMenu(); };
                iosMenuGroup.appendChild(btn);
            } else {
                items.forEach(item => {
                    const btn = document.createElement('button');
                    btn.className = 'ios-menu-item';
                    btn.textContent = item.label;
                    addTapEffect(btn);
                    btn.onclick = () => { onSelect(item); hideIOSMenu(); };
                    iosMenuGroup.appendChild(btn);
                });
            }

            iosOverlay.classList.add('show');
            iosMenu.classList.add('show');
        }
        
        function setupVolumeSlider() {
            const slider = document.getElementById('iosVolumeSlider');
            const fill = document.getElementById('iosVolumeFill');
            const thumb = document.getElementById('iosVolumeThumb');

            const updateVolumeUI = (percent) => {
                const pct = (percent * 100) + '%';
                fill.style.width = pct;
                thumb.style.left = pct;
            };

            const handleVolumeChange = (e) => {
                const rect = slider.getBoundingClientRect();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const percent = Math.max(0, Math.min(1, (clientX - rect.left) / rect.width));

                baseVolume = percent;
                saveToStorage('bg_baseVolume', baseVolume);
                updateVolumeUI(percent);

                if (isPlaying && gainNode && audioContext && (remainingSeconds <= 0 || remainingSeconds > FADE_DURATION)) {
                    gainNode.gain.cancelScheduledValues(audioContext.currentTime);
                    gainNode.gain.setValueAtTime(baseVolume, audioContext.currentTime);
                }
            };

            updateVolumeUI(baseVolume);

            const onPointerDown = (e) => {
                handleVolumeChange(e);
                const onPointerMove = (ev) => { ev.preventDefault(); handleVolumeChange(ev); };
                const onPointerUp = () => {
                    document.removeEventListener('mousemove', onPointerMove);
                    document.removeEventListener('mouseup', onPointerUp);
                    document.removeEventListener('touchmove', onPointerMove);
                    document.removeEventListener('touchend', onPointerUp);
                };
                document.addEventListener('mousemove', onPointerMove);
                document.addEventListener('mouseup', onPointerUp);
                document.addEventListener('touchmove', onPointerMove, { passive: false });
                document.addEventListener('touchend', onPointerUp);
            };
            slider.addEventListener('mousedown', onPointerDown);
            slider.addEventListener('touchstart', onPointerDown, { passive: true });
        }

        function hideIOSMenu() {
            iosOverlay.classList.remove('show');
            iosMenu.classList.remove('show');
        }

        addTapEffect(iosCancel);
        iosCancel.onclick = iosOverlay.onclick = hideIOSMenu;

        songSelectorBtn.onclick = () => {
            const items = musicData.map((m, i) => ({ label: m.name, value: i }));
            showIOSMenu(items, (item) => switchMusic(item.value));
        };

        timerBtn.onclick = () => {
            const items = getAllTimerOptions().map(o => ({ label: o.label || `${o.value} 分钟`, value: o.value, id: o.id }));
            items.push({ label: '自定义...', value: 'custom', id: 'custom' });
            showIOSMenu(items, (item) => {
                if (item.value === 'custom') {
                    showTimerEditModal();
                } else {
                    startTimer(item.value, item.id);
                }
            });
        };

        volumeBtn.onclick = () => showIOSMenu([], null, 'volume');
        countdownContainer.onclick = () => showIOSMenu([], null, 'countdown');

        // 定时器功能
        function startTimer(minutes, timerId) {
            clearInterval(timerInterval);
            remainingSeconds = minutes * 60;
            currentTimerId = timerId; // 修复 #2：存储唯一ID
            
            updateCountdownUI();
            countdownContainer.classList.add('visible');
            countdownContainer.classList.remove('ending');

            let lastTime = performance.now();
            function timerTick() {
                const now = performance.now();
                const elapsed = (now - lastTime) / 1000;
                
                if (elapsed >= 1) {
                    lastTime = now;
                    remainingSeconds -= Math.round(elapsed);
                    
                    if (remainingSeconds <= 0) {
                        if (isPlaying) togglePlay();
                        clearTimer();
                        return;
                    }
                    
                    if (isPlaying && remainingSeconds <= FADE_DURATION) {
                        const ratio = remainingSeconds / FADE_DURATION;
                        gainNode.gain.setValueAtTime(baseVolume * ratio, audioContext.currentTime);
                        countdownContainer.classList.add('ending');
                    }
                    updateCountdownUI();
                }
                timerInterval = requestAnimationFrame(timerTick);
            }
            timerInterval = requestAnimationFrame(timerTick);
        }

        function clearTimer() {
            if (typeof timerInterval === 'number') cancelAnimationFrame(timerInterval);
            timerInterval = null;
            remainingSeconds = 0;
            currentTimerId = null;
            countdownContainer.classList.remove('visible', 'ending');
            if (isPlaying && gainNode && audioContext) {
                gainNode.gain.setValueAtTime(baseVolume, audioContext.currentTime);
            }
        }

        function updateCountdownUI() {
            const allTimers = getAllTimerOptions();
            // 修复 #2：通过唯一ID查找定时器
            const timerOption = allTimers.find(t => t.id === currentTimerId);
            
            if (timerOption && timerOption.label) {
                countdownTime.textContent = timerOption.label;
            } else {
                const m = Math.ceil(remainingSeconds / 60);
                countdownTime.textContent = `${m} min`;
            }
        }

        // ==================== 自定义定时器功能 ====================
        
        let draggedItem = null;
        let editingTimerIndex = null;

        function showTimerEditModal() {
            hideIOSMenu();
            renderTimerEditList();
            timerEditModal.classList.add('show');
        }

        function hideTimerEditModal() {
            timerEditModal.classList.remove('show');
        }

        function renderTimerEditList() {
            const customTimers = loadCustomTimers();
            timerEditList.innerHTML = '';

            customTimers.forEach((timer, index) => {
                const item = document.createElement('div');
                item.className = 'timer-edit-item';
                item.draggable = true;
                item.dataset.index = index;

                const displayLabel = timer.label || `${timer.value} 分钟`;
                const timeText = timer.label ? `${timer.value} 分钟` : '';

                item.innerHTML = `
                    <div class="timer-drag-handle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M9 20q-.825 0-1.412-.587T7 18t.588-1.412T9 16t1.413.588T11 18t-.587 1.413T9 20m6 0q-.825 0-1.412-.587T13 18t.588-1.412T15 16t1.413.588T17 18t-.587 1.413T15 20M9 14q-.825 0-1.412-.587T7 12t.588-1.412T9 10t1.413.588T11 12t-.587 1.413T9 14m6 0q-.825 0-1.412-.587T13 12t.588-1.412T15 10t1.413.588T17 12t-.587 1.413T15 14M9 8q-.825 0-1.412-.587T7 6t.588-1.412T9 4t1.413.588T11 6t-.587 1.413T9 8m6 0q-.825 0-1.412-.587T13 6t.588-1.412T15 4t1.413.588T17 6t-.587 1.413T15 8"/></svg></div>
                    <div class="timer-edit-content">
                        <div class="timer-edit-label">${displayLabel}</div>
                        ${timeText ? `<div class="timer-edit-time">${timeText}</div>` : ''}
                    </div>
                    <button class="timer-delete-btn" data-index="${index}"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M7 21q-.825 0-1.412-.587T5 19V6H4V4h5V3h6v1h5v2h-1v13q0 .825-.587 1.413T17 21zM17 6H7v13h10zM9 17h2V8H9zm4 0h2V8h-2zM7 6v13z"/></svg></button>`;

                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('drop', handleDrop);
                item.querySelector('.timer-edit-content').addEventListener('click', () => { editingTimerIndex = index; showTimerForm(timer); });
                item.querySelector('.timer-delete-btn').addEventListener('click', (e) => { e.stopPropagation(); deleteTimer(index); });
                timerEditList.appendChild(item);
            });
        }

        function handleDragStart(e) {
            draggedItem = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd() {
            this.classList.remove('dragging');
            draggedItem = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            if (this === draggedItem) return;
            const rect = this.getBoundingClientRect();
            const isAfter = e.clientY > rect.top + rect.height / 2;
            this.parentNode.insertBefore(draggedItem, isAfter ? this.nextSibling : this);
        }

        function handleDrop(e) {
            e.stopPropagation();
            const customTimers = loadCustomTimers();
            const newOrder = Array.from(timerEditList.children).map(item => customTimers[parseInt(item.dataset.index)]);
            saveCustomTimers(newOrder);
            renderTimerEditList();
        }

        function showTimerForm(timer = null) {
            editingTimerIndex = null;
            if (timer) {
                const customTimers = loadCustomTimers();
                editingTimerIndex = customTimers.findIndex(t => t.label === timer.label && t.value === timer.value);
                timerFormTitle.textContent = '编辑定时器';
                timerLabelInput.value = timer.label || '';
                timerValueInput.value = timer.value;
            } else {
                timerFormTitle.textContent = '添加定时器';
                timerLabelInput.value = '';
                timerValueInput.value = '';
            }
            timerFormModal.classList.add('show');
        }

        function hideTimerForm() {
            timerFormModal.classList.remove('show');
        }

        function saveTimer() {
            const label = timerLabelInput.value.trim();
            const value = parseInt(timerValueInput.value);

            if (!value || value < 1 || value > 999) {
                alert('请输入 1 到 999 之间的有效时长（分钟）。');
                return;
            }

            const customTimers = loadCustomTimers();
            const timerData = { label, value };

            if (editingTimerIndex !== null && editingTimerIndex > -1) {
                customTimers[editingTimerIndex] = timerData;
            } else {
                customTimers.push(timerData);
            }

            saveCustomTimers(customTimers);
            hideTimerForm();
            renderTimerEditList();
        }

        function deleteTimer(index) {
            const customTimers = loadCustomTimers();
            customTimers.splice(index, 1);
            saveCustomTimers(customTimers);
            renderTimerEditList();
        }

        // 事件监听
        timerEditDone.onclick = hideTimerEditModal;
        timerAddBtn.onclick = () => showTimerForm();
        timerFormCancel.onclick = hideTimerForm;
        timerFormSave.onclick = saveTimer;
        timerEditModal.onclick = (e) => { if (e.target === timerEditModal) hideTimerEditModal(); };
        timerFormModal.onclick = (e) => { if (e.target === timerFormModal) hideTimerForm(); };

        const handleEnterKey = (e) => { if (e.key === 'Enter') saveTimer(); };
        timerValueInput.addEventListener('keypress', handleEnterKey);
        timerLabelInput.addEventListener('keypress', handleEnterKey);

        // ==================== 结束自定义定时器功能 ====================

        // 启动预加载
        preloadAllResources();
    </script>
</body>
</html>

